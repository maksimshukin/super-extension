# üéØ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ –ø–æ–¥–ø–∏—Å–æ–∫

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ

### –¢–∞–±–ª–∏—Ü—ã:
- **`plans`** - —Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã
- **`subscriptions`** - –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **`subscriptions_view`** - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

### –¢–∞—Ä–∏—Ñ—ã:
- **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ** (0‚ÇΩ, –±–µ—Å—Å—Ä–æ—á–Ω–æ)
- **1 –º–µ—Å—è—Ü** (300‚ÇΩ)
- **3 –º–µ—Å—è—Ü–∞** (300‚ÇΩ/–º–µ—Å, —Å–∫–∏–¥–∫–∞ 10%)
- **12 –º–µ—Å—è—Ü–µ–≤** (300‚ÇΩ/–º–µ—Å, —Å–∫–∏–¥–∫–∞ 20%)

## üöÄ –ö–∞–∫ –Ω–∞–∑–Ω–∞—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### 1. –ù–∞–π–¥–∏—Ç–µ UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```sql
SELECT id, email, raw_user_meta_data->>'full_name' as full_name
FROM auth.users 
WHERE email = 'user@example.com';
```

### 2. –ù–∞–π–¥–∏—Ç–µ UUID —Ç–∞—Ä–∏—Ñ–∞:
```sql
SELECT id, name FROM plans WHERE name = '1 –º–µ—Å—è—Ü';
```

### 3. –ù–∞–∑–Ω–∞—á—å—Ç–µ —Ç–∞—Ä–∏—Ñ:
```sql
SELECT assign_plan_to_user('USER_UUID', 'PLAN_UUID');
```

## üìä –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–æ–∫:
```sql
SELECT * FROM subscriptions_view ORDER BY "–ù–∞—á–∞–ª–æ" DESC;
```

### –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏:
```sql
SELECT * FROM subscriptions_view 
WHERE "–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–∞" = '–ê–∫—Ç–∏–≤–Ω–∞';
```

### –ò—Å—Ç–µ–∫—à–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏:
```sql
SELECT * FROM subscriptions_view 
WHERE "–ê–∫—Ç–∏–≤–Ω–∞ –¥–æ" < NOW() AND "–°—Ç–∞—Ç—É—Å" = 'active';
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```sql
SELECT check_user_access('USER_UUID');
```

## üîß –§—É–Ω–∫—Ü–∏–∏

- **`assign_plan_to_user(user_uuid, plan_uuid)`** - –Ω–∞–∑–Ω–∞—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ
- **`get_user_active_subscription(user_uuid)`** - –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
- **`check_user_access(user_uuid)`** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø
- **`get_user_subscription_info(user_uuid)`** - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

## ‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è** –ø–æ–¥–ø–∏—Å–∫–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø–æ–ª—è `updated_at`
- **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å** - –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
- **RLS –ø–æ–ª–∏—Ç–∏–∫–∏** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–°–º–æ—Ç—Ä–∏—Ç–µ —Ñ–∞–π–ª `supabase_examples.sql` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
