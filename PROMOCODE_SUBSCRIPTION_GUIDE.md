# üéüÔ∏è –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–¥–ø–∏—Å–∫–∏

## üö® –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Ä–µ—à–µ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–æ–º–æ–∫–æ–¥ `FREE3MONTHS` –ø—Ä–∏–º–µ–Ω—è–ª—Å—è, –Ω–æ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `apply_promocode_with_subscription`, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Ç–∏–ø–∞ "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–µ—Å—è—Ü—ã".

## üõ†Ô∏è –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **`apply_promocode_with_subscription`** - –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ –∏ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏** –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Ç–∏–ø–∞ `free_months`
- ‚úÖ **–ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É `promocode_usage`** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ popup.js
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é** `apply_promocode_with_subscription`
- ‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
- ‚úÖ **–û–±–Ω–æ–≤–ª—è–µ—Ç UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ **`get_user_subscription_status`** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –ø–ª–∞–Ω, –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è, —Å—Ç–∞—Ç—É—Å
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å

## üß™ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –¢–µ—Å—Ç 1: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ FREE3MONTHS

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–ø–∞–ø —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**
2. **–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É**
3. **–ù–∞–∂–º–∏—Ç–µ "–£–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–¥–ø–∏—Å–∫–æ–π"**
4. **–í–≤–µ–¥–∏—Ç–µ `FREE3MONTHS`** –≤ –ø–æ–ª–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
5. **–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"**

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ó–µ–ª–µ–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –í—ã –ø–æ–ª—É—á–∏–ª–∏ 3 –º–µ—Å—è—Ü–µ–≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ."
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑–º–µ–Ω–∏—Ç—Å—è —Å "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π" –Ω–∞ "1 –º–µ—Å—è—Ü" (–∏–ª–∏ –¥—Ä—É–≥–æ–π –ø–ª–∞–Ω)
- ‚úÖ –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

1. **–û—Ç–∫—Ä–æ–π—Ç–µ `test-promocode.html`**
2. **–í–≤–µ–¥–∏—Ç–µ `FREE3MONTHS`**
3. **–ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥"**

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```json
{
  "data": {
    "success": true,
    "subscription_created": true,
    "subscription_id": "uuid-here",
    "promocode": {
      "code": "FREE3MONTHS",
      "type": "free_months",
      "value": 3
    },
    "subscription": {
      "plan_name": "1 –º–µ—Å—è—Ü",
      "ends_at": "2024-12-16T...",
      "status": "active"
    },
    "message": "–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –í—ã –ø–æ–ª—É—á–∏–ª–∏ 3 –º–µ—Å—è—Ü–µ–≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ."
  },
  "error": null
}
```

### –¢–µ—Å—Ç 3: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞

1. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å `FREE3MONTHS` —Å–Ω–æ–≤–∞**
2. **–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É**: "–í—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —ç—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥"

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```
–ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥: FREE3MONTHS
–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞—Ä–∏—Ñ—ã...
–¢–∞—Ä–∏—Ñ—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã: Array(1)
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ab657cd0-ee3d-4748-832a-e424ad29dc79
–í—ã–∑—ã–≤–∞–µ–º apply_promocode_with_subscription —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: Object
–†–µ–∑—É–ª—å—Ç–∞—Ç apply_promocode_with_subscription: Object
–ü—Ä–æ–º–æ–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω: Object
–ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: Object
showPromocodeMessage –≤—ã–∑–≤–∞–Ω–∞: {message: "–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –í—ã –ø–æ–ª—É—á–∏–ª–∏ 3 –º–µ—Å—è—Ü–µ–≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ.", isSuccess: true}
```

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
- **–¢–∞–±–ª–∏—Ü–∞ `subscriptions`**: –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å `status = 'active'` –∏ `ends_at` —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞
- **–¢–∞–±–ª–∏—Ü–∞ `promocode_usage`**: –∑–∞–ø–∏—Å—å –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- **–¢–∞–±–ª–∏—Ü–∞ `promocodes`**: —Å—á–µ—Ç—á–∏–∫ `used_count` —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ 1

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –ß–µ—Ä–µ–∑ SQL –∑–∞–ø—Ä–æ—Å:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT s.*, p.name as plan_name 
FROM subscriptions s 
JOIN plans p ON s.plan_id = p.id 
WHERE s.user_id = 'USER_UUID' 
AND s.status = 'active';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
SELECT pu.*, p.code, p.name 
FROM promocode_usage pu 
JOIN promocodes p ON pu.promocode_id = p.id 
WHERE pu.user_id = 'USER_UUID';
```

### –ß–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ:
1. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–ø–∞–ø** - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è** - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–º–æ–∫–æ–¥—ã —Ç–∏–ø–∞ "free_months":
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏** –±–µ–∑ –æ–ø–ª–∞—Ç—ã
- ‚úÖ **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω** –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** –æ–¥–Ω–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

### –ü—Ä–æ–º–æ–∫–æ–¥—ã —Ç–∏–ø–∞ "percentage" –∏ "fixed_amount":
- ‚úÖ **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏** –∫ —Ü–µ–Ω–µ —Ç–∞—Ä–∏—Ñ–∞
- ‚úÖ **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–µ–Ω** –≤ —Å–ø–∏—Å–∫–µ —Ç–∞—Ä–∏—Ñ–æ–≤
- ‚úÖ **–ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞** –≤ —Ñ—É–Ω–∫—Ü–∏—é –æ–ø–ª–∞—Ç—ã

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ `FREE3MONTHS`:

1. **–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è** –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
2. **–°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞** –Ω–∞ 3 –º–µ—Å—è—Ü–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ
3. **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** –ø—Ä–æ–º–æ–∫–æ–¥–∞
4. **–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è UI** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø** –∫ —Å–µ—Ä–≤–∏—Å—É

**–ü—Ä–æ–º–æ–∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ!** üéâ
